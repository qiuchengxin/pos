package com.market.pos.tool.hideroom;import com.google.gson.Gson;import com.market.pos.pojo.AskQQMessage;import java.text.SimpleDateFormat;import java.util.Date;//"我要闭关"public class HideRoom {    public static String ask;    public static void hideRoom(String qqid,String belongId){        AskQQMessage askQQMessage = new AskQQMessage();        askQQMessage.setAct("106");        askQQMessage.setQQID(qqid);        hideRoomService.selectHideRoom(qqid,belongId);        String start_time = hideRoomService.start_time;        String userid = hideRoomService.userid;        Date date = new Date();        long time_start = date.getTime();        if (userid == null){            //没有闭关过            //先在hideroom表中插入用户的userid            hideRoomService.insertHideRoom(qqid,belongId);            hideRoomService.updateHideRoom(qqid,"start_time", String.valueOf(time_start),belongId);            askQQMessage.setMsg("[CQ:at,qq=" + qqid + "] 闭关成功！" +                    "\n闭关时长为2小时，在此期间若是不被打扰，则闭关成功，得到五百点修为值。若是被人偷袭，则前功尽弃，失去五百点修为 ！");            ask = new Gson().toJson(askQQMessage);            hideRoomService.updateHideRoom(qqid,"is_ok","1",belongId);            hideRoomService.updateHideRoom(qqid,"is_hurt","0",belongId);        }else {            if (start_time == null){                hideRoomService.updateHideRoom(qqid,"start_time", String.valueOf(time_start),belongId);                askQQMessage.setMsg("[CQ:at,qq=" + qqid + "] 闭关成功！" +                        "\n闭关时长为2小时，在此期间若是不被打扰，则闭关成功，得到五百点修为值。若是被人偷袭，则前功尽弃，失去五百点修为 ！");                ask = new Gson().toJson(askQQMessage);                hideRoomService.updateHideRoom(qqid,"is_ok","1",belongId);            }            else {                long start_time_long = Long.valueOf(start_time);                SimpleDateFormat df = new SimpleDateFormat("HH:mm:ss");                String time = df.format(start_time_long);                hideRoomService.selectHideRoom(qqid,belongId);                int is_hurt = hideRoomService.is_hurt;                if (is_hurt == 1){                    askQQMessage.setMsg("[CQ:at,qq=" + qqid + "] 今天已经闭关过了！" +                            "\n少侠今日的闭关时间是 " + time + " ! 但是不幸，闭关途中遭遇敌人偷袭，闭关失败，失去五百修为 。");                    ask = new Gson().toJson(askQQMessage);                    hideRoomService.updateHideRoom(qqid,"is_ok","1",belongId);                }else {                    Date date_now = new Date() ;                    long time_now = date_now.getTime();                    long time_ch = time_now - start_time_long;                    double min = (double)time_ch / 60000;                    int minutes = (int)min;                    askQQMessage.setMsg("[CQ:at,qq=" + qqid + "] 今天已经闭关过了！" +                            "\n少侠今日的闭关时间是 " + time + " ! 已成功闭关 " + minutes + " 分钟，请隐藏好自己哦 ！");                    ask = new Gson().toJson(askQQMessage);                    hideRoomService.updateHideRoom(qqid,"is_ok","1",belongId);                }            }        }    }}